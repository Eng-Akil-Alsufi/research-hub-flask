{% extends "base.html" %}

{% block title %}{% if mode == 'add' %}Ø¥Ø¶Ø§ÙØ© Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯{% else %}ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø«{% endif %} - Research Hub DB{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>{% if mode == 'add' %}Ø¥Ø¶Ø§ÙØ© Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯{% else %}ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø«{% endif %}</h1>
    </div>

    <form action="{% if mode == 'add' %}{{ url_for('add_research') }}{% else %}{{ url_for('edit_research', paper_id=paper.PaperID) }}{% endif %}" 
          method="POST" 
          enctype="multipart/form-data" 
          class="research-form">
        
        <div class="form-group">
            <label for="title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø« *</label>
            <input 
                type="text" 
                id="title" 
                name="title" 
                class="form-control" 
                value="{% if paper %}{{ paper.Title }}{% endif %}"
                required
            >
        </div>

        <div class="form-group">
            <label for="abstract">Ø§Ù„Ù…Ù„Ø®Øµ</label>
            <textarea 
                id="abstract" 
                name="abstract" 
                class="form-control" 
                rows="6"
            >{% if paper %}{{ paper.Abstract }}{% endif %}</textarea>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="year">Ø³Ù†Ø© Ø§Ù„Ù†Ø´Ø± *</label>
                <input 
                    type="number" 
                    id="year" 
                    name="year" 
                    class="form-control" 
                    value="{% if paper %}{{ paper.PublicationYear }}{% endif %}"
                    min="1900" 
                    max="2100"
                    required
                >
            </div>

            <div class="form-group">
                <label for="student_id">Ø§Ù„Ø·Ø§Ù„Ø¨ *</label>
                <select id="student_id" name="student_id" class="form-control" required>
                    <option value=""> Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ </option>
                    {% for student in students %}
                        <option value="{{ student.StudentID }}" 
                                {% if paper and paper.StudentID == student.StudentID %}selected{% endif %}>
                            {{ student.Name }} ({{ student.StudentID }})
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="department_id">Ø§Ù„Ù‚Ø³Ù… *</label>
            <select id="department_id" name="department_id" class="form-control" required>
                <option value=""> Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… </option>
                {% for department in departments %}
                    <option value="{{ department.DepartmentID }}"
                            {% if paper and paper.DepartmentID == department.DepartmentID %}selected{% endif %}>
                        {{ department.DepartmentName }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ / Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©</label>
            <div class="topics-checkboxes">
                {% for topic in topics %}
                    <label class="checkbox-label">
                        <input 
                            type="checkbox" 
                            name="topics" 
                            value="{{ topic.TopicID }}"
                            {% if selected_topics and topic.TopicID in selected_topics %}checked{% endif %}
                        >
                        {{ topic.TopicName }}
                    </label>
                {% endfor %}
            </div>
        </div>

        <div class="form-group">
            <label for="file">Ù…Ù„Ù Ø§Ù„Ø¨Ø­Ø« (PDF)</label>
            {% if paper and paper.FilePath %}
                <p class="text-muted">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ: {{ paper.FilePath }}</p>
                <input type="hidden" name="existing_file_path" value="{{ paper.FilePath }}">
            {% endif %}
            <input 
                type="file" 
                id="file" 
                name="file" 
                class="form-control" 
                accept=".pdf"
            >
            <small class="form-text">Ø§Ø®ØªØ± Ù…Ù„Ù PDF Ø¬Ø¯ÙŠØ¯ Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</small>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                {% if mode == 'add' %}â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø­Ø«{% else %}ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª{% endif %}
            </button>
            <a href="{{ url_for('supervisor_dashboard') }}" class="btn btn-secondary">Ø¥Ù„ØºØ§Ø¡</a>
        </div>
    </form>
</div>
{% endblock %}